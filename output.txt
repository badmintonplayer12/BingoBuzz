Folder Structure
--------------------------------------------------
/
    index.html
assets/
    css/
        style.css
    icons/
    js/
        app.js
        audio-engine.js
        constants.js
        manifest.js
        playlist.js
        storage.js
    sounds/
        BingoBlast.mp3
        BingoBlast2.mp3
        bingobuzz/
            manifest.json
            NonCommerseLicense/
                ANeiJegMenerAJaBingo.mp3
                BingoBaby.mp3
                BingoBaby1.mp3
                BingoBash.mp3
                BingoBash1.mp3
                BingoBeat.mp3
                BingoBeat1.mp3
                BINGOEnOperajingle.mp3
                BINGOEnOperajingle1.mp3
                BingoFever.mp3
                BingoFever1.mp3
                BingoJingle.mp3
                BingoJingle1.mp3
                BingoJingle2.mp3
                BingoJingle3.mp3
                BingoShowstopper.mp3
                BingoShowstopper1.mp3
                JATAKK.mp3
                JegFikkBingo.mp3
                JegFikkBingo1.mp3
                JegSkalHaGull.mp3
                JegSkalHaGull1.mp3
                KakeTilMeg.mp3
                KakeTilMeg1.mp3
                PREMIEJEGFIKKPREMIE.mp3
                PREMIEJEGFIKKPREMIE1.mp3
                Premiejubel.mp3
                Premiejubel1.mp3
                WoohooRevolt.mp3
docs/
    ROADMAP.md


File Contents
--------------------------------------------------


index.html
File type: .html
<!DOCTYPE html>
<html lang="no">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>BingoBuzz</title>
    <link rel="stylesheet" href="assets/css/style.css">
    <meta name="description" content="BingoBuzz – spill neste festlige bingolyd med et klikk.">
  </head>
  <body>
    <main class="big-btn-screen" aria-live="polite">
      <button id="action-button" class="big-btn" type="button" aria-label="Start neste"></button>

      <div class="reset-banner" hidden>
        <button id="reset-session" type="button" class="reset-chip">
          Alt spilt · Start på nytt
        </button>
      </div>
    </main>

    <noscript>
      <p class="noscript-warning">
        BingoBuzz trenger JavaScript for å spille av festlige lyder. Aktiver JavaScript og last siden på nytt.
      </p>
    </noscript>

    <script type="module" src="assets/js/app.js"></script>
  </body>
</html>


--------------------------------------------------
File End
--------------------------------------------------


assets\css\style.css
File type: .css
:root {
  --bg-start: #352b6b;
  --bg-mid: #1b1638;
  --bg-end: #0a0818;
  --bg-tint-hue: 210;
  --btn-color-start: #ffe066;
  --btn-color-mid: #ffb347;
  --btn-color-end: #ad5b00;
  --btn-active-glow: rgba(255, 220, 120, 0.85);
  --btn-idle-glow: rgba(255, 210, 90, 0.45);
  --btn-fade-glow: rgba(120, 200, 255, 0.8);
  --status-bg: rgba(0, 0, 0, 0.32);
  --status-border: rgba(255, 255, 255, 0.24);
  --status-text: rgba(255, 255, 255, 0.92);
  --reset-bg: rgba(255, 255, 255, 0.12);
  --reset-text: rgba(255, 255, 255, 0.85);
  --font-stack: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
}

*,
*::before,
*::after {
  box-sizing: border-box;
}

html,
body {
  margin: 0;
  height: 100%;
  width: 100%;
  font-family: var(--font-stack);
  background:
    radial-gradient(circle at 42% 38%, var(--bg-start) 0%, var(--bg-mid) 50%, var(--bg-end) 100%),
    radial-gradient(150vmax 150vmax at 65% 25%, rgba(255, 255, 255, 0.07), transparent 70%),
    radial-gradient(120vmax 120vmax at 50% 80%, rgba(0, 0, 0, 0.25), rgba(0, 0, 0, 0.55));
  background-attachment: fixed;
  background-size: 200% 200%, 200% 200%, 100% 100%;
  color: #fff;
  display: grid;
  place-items: center;
}

body::before {
  content: "";
  position: fixed;
  inset: -25vmax;
  z-index: 0;
  pointer-events: none;
  border-radius: 50%;
  background: radial-gradient(
    circle at 50% 50%,
    hsla(var(--theme-hue, 200), 75%, 50%, 0.16) 0%,
    hsla(var(--theme-hue, 200), 70%, 40%, 0.06) 40%,
    transparent 78%
  );
  filter: blur(110px);
  opacity: var(--aura-opacity, 0.45);
  transform: scale(var(--aura-scale, 1));
  transition: opacity 420ms ease, transform 800ms ease;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  background: radial-gradient(
    circle at 40% 35%,
    hsla(var(--bg-tint-hue), 35%, 30%, 0.18),
    hsla(var(--bg-tint-hue), 30%, 15%, 0) 70%
  );
  mix-blend-mode: screen;
}

body.-playing::before {
  --aura-opacity: 0.55;
}

body.-fading::before {
  --aura-opacity: 0.45;
}

.big-btn-screen {
  position: relative;
  width: 100%;
  height: 100%;
  display: grid;
  place-items: center;
  gap: 2.5rem;
  z-index: 1;
}

.big-btn-screen::before {
  content: "";
  position: fixed;
  inset: -10vmax;
  z-index: 0;
  pointer-events: none;
  opacity: 0.22;
  mix-blend-mode: screen;
  background:
    radial-gradient(circle at 30% 40%, hsla(var(--theme-hue, 210), 80%, 55%, 0.25) 0%, transparent 60%),
    radial-gradient(circle at 70% 60%, hsla(calc(var(--theme-hue, 210) + 60), 80%, 45%, 0.22) 0%, transparent 70%),
    radial-gradient(circle at 50% 90%, hsla(calc(var(--theme-hue, 210) + 120), 80%, 40%, 0.18) 0%, transparent 75%);
  background-size: 160% 160%;
  filter: blur(60px) saturate(120%);
}

body.-playing .big-btn-screen::before {
  opacity: 0.3;
  animation-duration: 28s;
  filter: blur(50px) saturate(140%);
}

body.-fading .big-btn-screen::before {
  opacity: 0.26;
  animation-duration: 22s;
}


.big-btn {
  position: relative;
  width: min(85vmin, 620px);
  height: min(85vmin, 620px);
  border-radius: 50%;
  border: none;
  cursor: pointer;
  -webkit-tap-highlight-color: transparent;
  background: radial-gradient(
    circle at 30% 30%,
    var(--btn-color-start) 0%,
    var(--btn-color-mid) 55%,
    var(--btn-color-end) 100%
  );
  box-shadow:
    0 22px 60px rgba(0, 0, 0, 0.55),
    inset 0 0 36px hsla(var(--theme-hue, 200), 40%, 88%, 0.18),
    inset 0 -18px 30px rgba(0, 0, 0, 0.35);
  transition:
    transform 140ms ease,
    box-shadow 220ms ease,
    background 1200ms ease;
  display: grid;
  place-items: center;
  color: #fff;
  text-shadow: 0 2px 4px rgba(0, 0, 0, 0.45);
  z-index: 1;
}

.big-btn::before {
  content: "";
  position: absolute;
  inset: 12% 12% 50% 12%;
  border-radius: 50% 50% 46% 46% / 60% 60% 40% 40%;
  background: radial-gradient(120% 100% at 60% 20%, rgba(255, 255, 255, 0.55), rgba(255, 255, 255, 0.08) 55%, transparent 70%);
  filter: saturate(1.05);
  pointer-events: none;
}

.big-btn::after {
  content: "";
  position: absolute;
  inset: -10%;
  border-radius: 50%;
  pointer-events: none;
  opacity: 0;
  background: radial-gradient(circle, hsla(var(--theme-hue, 200), 90%, 65%, 0.35) 0%, hsla(var(--theme-hue, 200), 90%, 50%, 0) 60%);
  transform: scale(0.6);
  transition: transform 420ms ease, opacity 420ms ease;
}



.big-btn:hover {
  box-shadow:
    0 28px 70px rgba(0, 0, 0, 0.6),
    inset 0 0 44px rgba(255, 255, 255, 0.26),
    inset 0 -20px 36px rgba(0, 0, 0, 0.35);
}

.big-btn:active {
  transform: translateY(6px) scale(0.98);
  box-shadow:
    0 14px 36px rgba(0, 0, 0, 0.65),
    inset 0 0 30px rgba(255, 255, 255, 0.22),
    inset 0 -8px 18px rgba(0, 0, 0, 0.5);
}

.big-btn:active::after {
  opacity: 0.9;
  transform: scale(1.8);
}


.big-btn:focus-visible {
  outline: none;
  box-shadow:
    0 0 0 8px rgba(255, 255, 255, 0.35),
    0 0 40px var(--btn-idle-glow),
    inset 0 0 36px rgba(255, 255, 255, 0.35);
}

.big-btn.is-playing {
  animation: pulse-playing 1.8s ease-in-out infinite;
}

.big-btn.is-fading,
.big-btn[disabled] {
  cursor: not-allowed;
  transform: translateY(16px) scale(0.86);
  transition: transform calc(var(--fade-ms, 1200ms) * 1.05) cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: none;
}

.reset-banner {
  position: absolute;
  top: 8%;
  left: 50%;
  transform: translateX(-50%);
}

.reset-chip {
  border: none;
  border-radius: 999px;
  padding: 0.65rem 1.4rem;
  background: var(--reset-bg);
  color: var(--reset-text);
  font-size: 0.95rem;
  letter-spacing: 0.03em;
  cursor: pointer;
  transition: transform 200ms ease, background-color 200ms ease;
}

.reset-chip:hover {
  transform: translateY(-2px);
  background: rgba(255, 255, 255, 0.2);
}

.reset-chip:focus-visible {
  outline: none;
  box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.35);
}

.noscript-warning {
  position: absolute;
  bottom: 5%;
  left: 50%;
  transform: translateX(-50%);
  max-width: 480px;
  padding: 1.25rem 1.75rem;
  border-radius: 16px;
  background: rgba(255, 247, 185, 0.2);
  color: #fff3c0;
  font-weight: 500;
  text-align: center;
}


@keyframes pulse-playing {
  0%,
  100% {
    box-shadow:
      0 18px 50px rgba(0, 0, 0, 0.4),
      0 0 110px var(--btn-active-glow);
  }
  50% {
    box-shadow:
      0 28px 70px rgba(0, 0, 0, 0.45),
      0 0 170px var(--btn-active-glow);
  }
}

@keyframes pulse-fading {
  0%,
  100% {
    box-shadow:
      0 20px 60px rgba(0, 0, 0, 0.5),
      0 0 120px var(--btn-fade-glow),
      inset 0 0 34px hsla(var(--theme-hue, 200), 60%, 75%, 0.28),
      inset 0 -16px 26px rgba(0, 0, 0, 0.32);
  }
  50% {
    box-shadow:
      0 24px 70px rgba(0, 0, 0, 0.45),
      0 0 160px hsla(var(--theme-hue, 200), 70%, 68%, 0.75),
      inset 0 0 46px hsla(var(--theme-hue, 200), 65%, 78%, 0.34),
      inset 0 -18px 28px rgba(0, 0, 0, 0.3);
  }
}

@keyframes bg-shift {
  0% {
    background-position: 30% 30%;
  }
  50% {
    background-position: 70% 70%;
  }
  100% {
    background-position: 50% 50%;
  }
}

@keyframes nebula-move {
  0% {
    background-position: 40% 60%, 60% 40%, 50% 80%;
    transform: scale(1);
  }
  50% {
    background-position: 60% 40%, 40% 60%, 48% 85%;
    transform: scale(1.05);
  }
  100% {
    background-position: 50% 50%, 50% 50%, 50% 90%;
    transform: scale(1);
  }
}


@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
    scroll-behavior: auto !important;
  }
  .big-btn,
  .big-btn.is-playing,
  .big-btn.is-fading {
    animation: none;
  }
}


@keyframes popBack {
  0% {
    transform: translateY(16px) scale(0.86);
  }
  55% {
    transform: translateY(-3px) scale(1.05);
  }
  100% {
    transform: translateY(0) scale(1);
  }
}

.big-btn.post-bounce {
  animation: popBack 420ms cubic-bezier(.2,.9,.3,1.4) both;
}


--------------------------------------------------
File End
--------------------------------------------------


assets\js\app.js
File type: .js
import { SESSION_TTL_MS, STOP_FADE_MS } from "./constants.js";
import { createAudioEngine } from "./audio-engine.js";
import { createPlaylist } from "./playlist.js";
import { createStorage } from "./storage.js";
import { loadManifest } from "./manifest.js";

/**
 * Phase 2 scaffold: DOM references plus manifest/storage bootstrap.
 * Detailed playback logic lands in later roadmap steps.
 */

const elements = {
  actionButton: document.querySelector("#action-button"),
  actionLabel: document.querySelector("#action-button .big-btn__label"),
  screen: document.querySelector(".big-btn-screen"),
  statusLine: document.querySelector("#status-line"),
  resetBanner: document.querySelector(".reset-banner"),
  resetBtn: document.querySelector("#reset-session"),
};

if (!elements.actionButton || !elements.statusLine) {
  console.warn("BingoBuzz UI elements missing; check markup.");
}

const audioEngine = createAudioEngine();
const playlist = createPlaylist();
const storage = createStorage({ ttl: SESSION_TTL_MS });
let manifestRef = null;
let sessionRef = null;
const disposables = [];
let hueOffset = Math.random() * 360;

function persistSession({ index, order } = {}) {
  const snapshot = playlist.snapshot();
  const manifestEtag = manifestRef?.manifestEtag ?? null;
  const createdAt = sessionRef?.createdAt ?? Date.now();

  storage.saveSession({
    playlistIds: order ?? snapshot.order,
    index: typeof index === "number" ? index : snapshot.index,
    createdAt,
    manifestEtag,
  });

  sessionRef = {
    ...sessionRef,
    playlistIds: order ?? snapshot.order,
    index: typeof index === "number" ? index : snapshot.index,
    createdAt,
    manifestEtag,
  };
}

function resetSession() {
  audioEngine.cancelPrepare?.();
  audioEngine.stopImmediate();
  const snapshot = playlist.reset();
  sessionRef = {
    playlistIds: snapshot.order,
    index: snapshot.index,
    createdAt: Date.now(),
    manifestEtag: manifestRef?.manifestEtag ?? null,
  };
  storage.saveSession(sessionRef);
  updateUi({
    statusText: `Klar · #${playlist.cursor + 1} av ${playlist.size} gjenstår`,
    actionLabel: "Start neste",
    actionDisabled: false,
    actionBusy: false,
    buttonState: "idle",
    showReset: false,
  });
  prefetchUpcomingClip();
}

function prefetchUpcomingClip() {
  if (typeof audioEngine.prepare !== "function") {
    return;
  }
  const upcoming = playlist.peek?.();
  if (!upcoming) {
    audioEngine.cancelPrepare?.();
    return;
  }
  audioEngine
    .prepare(upcoming)
    ?.catch((error) => console.warn("Prefetch failed", error));
}

function handlePlaybackEnded({ reason } = {}) {
  if (reason === "cleanup" || reason === "error") {
    return;
  }
  if (playlist.isComplete()) {
    updateUi({
      statusText: "Alt spilt i denne økta · Start på nytt",
      actionLabel: "Alt spilt",
      actionDisabled: true,
      actionBusy: false,
      buttonState: "idle",
      showReset: true,
    });
    audioEngine.cancelPrepare?.();
  } else {
    updateUi({
      statusText: `Klar · #${playlist.cursor + 1} av ${playlist.size} gjenstår`,
      actionLabel: "Start neste",
      actionDisabled: false,
      actionBusy: false,
      buttonState: "idle",
      showReset: false,
    });
    prefetchUpcomingClip();
  }
}

function updateUi({
  statusText,
  actionLabel: label,
  actionDisabled,
  actionBusy,
  buttonState,
  showReset,
}) {
  if (typeof label === "string") {
    if (elements.actionLabel) {
      elements.actionLabel.textContent = label;
    }
    // Always update aria-label even if actionLabel element doesn't exist
    elements.actionButton?.setAttribute("aria-label", label);
  }
  if (typeof actionDisabled === "boolean" && elements.actionButton) {
    elements.actionButton.disabled = actionDisabled;
  }
  if (typeof actionBusy === "boolean" && elements.actionButton) {
    if (actionBusy) {
      elements.actionButton.setAttribute("aria-busy", "true");
    } else {
      elements.actionButton.removeAttribute("aria-busy");
      elements.actionButton.classList.remove("is-busy");
    }
  }

  if (typeof statusText === "string" && elements.statusLine) {
    elements.statusLine.textContent = statusText;
  }
  if (typeof showReset === "boolean" && elements.resetBanner) {
    elements.resetBanner.hidden = !showReset;
  }

  if (elements.actionButton) {
    elements.actionButton.classList.remove("is-playing", "is-fading");
    if (buttonState === "playing") {
      elements.actionButton.classList.add("is-playing");
    } else if (buttonState === "fading") {
      elements.actionButton.classList.add("is-fading");
    }
  }

  if (typeof buttonState === "string" && typeof document !== "undefined") {
    if (buttonState === "playing") {
      document.body.classList.add("-playing");
      document.body.classList.remove("-fading");
    } else if (buttonState === "fading") {
      document.body.classList.add("-fading");
      document.body.classList.remove("-playing");
    } else {
      document.body.classList.remove("-playing", "-fading");
    }
  }
}

function nextHue() {
  const goldenAngle = 137.508;
  hueOffset = (hueOffset + goldenAngle) % 360;
  return hueOffset;
}

function updateButtonColor() {
  const hue = nextHue();
  const sat = 80 + Math.random() * 10;
  const light = 45 + Math.random() * 10;

  document.documentElement.style.setProperty("--theme-hue", String(hue));
  document.documentElement.style.setProperty("--bg-tint-hue", String((hue + 200) % 360));
  document.documentElement.style.setProperty("--btn-color-start", `hsl(${hue}, ${sat}%, ${light + 15}%)`);
  document.documentElement.style.setProperty("--btn-color-mid", `hsl(${(hue + 20) % 360}, ${sat}%, ${light}%)`);
  document.documentElement.style.setProperty("--btn-color-end", `hsl(${(hue + 40) % 360}, ${sat}%, ${light - 10}%)`);

  document.documentElement.style.setProperty("--btn-active-glow", `hsla(${hue}, 90%, 70%, 0.9)`);
  document.documentElement.style.setProperty("--btn-idle-glow", `hsla(${hue}, 85%, 65%, 0.55)`);
  document.documentElement.style.setProperty("--btn-fade-glow", `hsla(${(hue + 30) % 360}, 85%, 75%, 0.75)`);

}

async function playClipResult(result) {
  if (!result || !result.clip) {
    updateUi({
      statusText: "Alt spilt i denne økta · Start på nytt",
      actionLabel: "Alt spilt",
      actionDisabled: true,
      actionBusy: false,
      buttonState: "idle",
      showReset: true,
    });
    return;
  }
  try {
    updateUi({
      statusText: `Spiller #${result.index + 1} av ${result.total} …`,
      actionLabel: "Fade ut",
      actionDisabled: false,
      actionBusy: false,
      buttonState: "playing",
      showReset: false,
    });

    await audioEngine.play(result.clip);
    playlist.markSuccess();
    persistSession({ index: playlist.cursor });
    prefetchUpcomingClip();

    updateUi({
      statusText: `Spiller #${result.index + 1} av ${result.total} …`,
      actionLabel: "Fade ut",
      actionDisabled: false,
      actionBusy: false,
      buttonState: "playing",
    });
  } catch (error) {
    console.error("playClipResult failed", error);

    if (error?.name === "NotAllowedError") {
      updateUi({
        statusText: "Tillat avspilling i nettleseren og prøv igjen.",
        actionLabel: "Start neste",
        actionDisabled: false,
        actionBusy: false,
        buttonState: "idle",
        showReset: false,
      });
      return;
    }

    const skipResult = playlist.skipFailed(result.clip?.id);
    if (skipResult.clip) {
      persistSession({
        index: playlist.cursor,
        order: playlist.snapshot().order,
      });
      updateUi({
        statusText: "Hoppet over en fil · prøver neste …",
        actionLabel: "Start neste",
        actionDisabled: false,
        actionBusy: false,
        buttonState: "idle",
        showReset: false,
      });
      await playClipResult(skipResult);
    } else {
      updateUi({
        statusText: "Kunne ikke spille av klippene · Start på nytt",
        actionLabel: "Alt spilt",
        actionDisabled: true,
        actionBusy: false,
        buttonState: "idle",
        showReset: true,
      });
    }
  }
}

async function playNext() {
  const nextResult = playlist.next();
  if (nextResult?.clip) {
    updateButtonColor();
  }
  await playClipResult(nextResult);
}

async function handleActionClick() {
  if (audioEngine.state === "playing") {
    updateUi({
      statusText: "Fader ut …",
      actionLabel: "Fader ut …",
      actionDisabled: true,
      actionBusy: true,
      buttonState: "fading",
      showReset: false,
    });
    elements.actionButton?.style.setProperty("--fade-ms", `${STOP_FADE_MS}ms`);
    try {
      await audioEngine.fadeOut(STOP_FADE_MS);
      elements.actionButton?.classList.add("post-bounce");
      setTimeout(() => elements.actionButton?.classList.remove("post-bounce"), 420);
      elements.actionButton?.style.removeProperty("--fade-ms");
    } catch (error) {
      console.error("Fade out failed", error);
      updateUi({
        statusText: "Fade feilet · prøv igjen",
        actionLabel: "Start neste",
        actionDisabled: false,
        actionBusy: false,
        buttonState: "idle",
      });
    } finally {
      elements.actionButton?.style.removeProperty("--fade-ms");
    }
    return;
  }

  if (audioEngine.state === "fading") {
    updateUi({ actionBusy: true, buttonState: "fading" });
    return;
  }

  if (playlist.isComplete()) {
    updateUi({
      statusText: "Alt spilt i denne økta · Start på nytt",
      actionLabel: "Alt spilt",
      actionDisabled: true,
      actionBusy: false,
      buttonState: "idle",
      showReset: true,
    });
    return;
  }

  updateUi({ actionBusy: true, buttonState: "playing" });
  await playNext();
}

function bindUi() {
  disposables.push(audioEngine.on("ended", handlePlaybackEnded));

  elements.actionButton?.addEventListener("click", () => {
    void handleActionClick();
  });
  elements.resetBtn?.addEventListener("click", () => {
    resetSession();
  });

  // Use document-level click handler to catch clicks outside the button
  // This ensures we catch clicks even when they bubble up from child elements
  document.addEventListener("click", (event) => {
    if (!event || !elements.actionButton || !elements.screen) {
      return;
    }

    const target = event.target;

    if (elements.actionButton === target || elements.actionButton.contains(target)) {
      return;
    }

    if (elements.resetBtn && (elements.resetBtn === target || elements.resetBtn.contains(target))) {
      return;
    }

    if (elements.screen === target || elements.screen.contains(target)) {
      toggleFullscreen({ userInitiated: true });
    }
  });
}

function toggleFullscreen({ userInitiated = false } = {}) {
  if (typeof document === "undefined") {
    return;
  }
  if (!document.fullscreenEnabled) {
    return;
  }
  if (document.fullscreenElement) {
    if (document.exitFullscreen) {
      document.exitFullscreen().catch(() => {});
    }
    return;
  }
  if (!userInitiated) {
    return;
  }
  const target = document.documentElement;
  if (target.requestFullscreen) {
    target.requestFullscreen().catch(() => {});
  }
}

if (typeof window !== "undefined") {
  window.bingoBuzzDebug = {
    playlist,
    audioEngine,
    storage,
    getState() {
      return {
        audioState: audioEngine.state,
        manifest: manifestRef,
        playlist: playlist.snapshot(),
        session: sessionRef,
      };
    },
    resetPlaylist() {
      resetSession();
      return playlist.snapshot();
    },
  };

  window.addEventListener("beforeunload", () => {
    disposables.splice(0).forEach((dispose) => {
      try {
        dispose?.();
      } catch (error) {
        console.warn("cleanup listener failed", error);
      }
    });
  });
}

async function bootstrap() {
  console.info("BingoBuzz bootstrap (Phase 2)");
  bindUi();

  const { manifest, error } = await loadManifest();
  manifestRef = manifest;
  if (manifest?.ttlMs) {
    storage.setTtl(manifest.ttlMs);
  }
  const session = storage.loadSession();
  sessionRef = session;
  const resetDecision = storage.shouldReset({
    session,
    manifestEtag: manifest?.manifestEtag ?? null,
  });

  if (resetDecision.reset) {
    storage.clearSession();
    sessionRef = null;
  }

  let playlistSnapshot = null;
  const files = manifest?.files ?? [];

  if (files.length) {
    const reuseSession = Boolean(session && !resetDecision.reset);
    if (reuseSession && session) {
      playlistSnapshot = playlist.init(files, {
        order: session.playlistIds,
        index: session.index,
      });
      sessionRef = {
        playlistIds: playlistSnapshot.order,
        index: playlistSnapshot.index,
        createdAt: session.createdAt,
        manifestEtag: manifest?.manifestEtag ?? session.manifestEtag ?? null,
      };
      storage.saveSession(sessionRef);
    } else {
      playlistSnapshot = playlist.init(files);
      sessionRef = {
        playlistIds: playlistSnapshot.order,
        index: playlistSnapshot.index,
        createdAt: Date.now(),
        manifestEtag: manifest?.manifestEtag ?? null,
      };
      storage.saveSession(sessionRef);
    }
  } else {
    playlistSnapshot = playlist.init([]);
    sessionRef = null;
  }

  console.info("BingoBuzz state snapshot", {
    manifest,
    manifestError: error,
    session: resetDecision.reset ? null : session,
    resetDecision,
    audioEngine,
    playlist,
    playlistSnapshot,
  });

  audioEngine.configure({
    formats: manifest?.formats,
    basePath: manifest?.basePath ?? undefined,
  });

  if (playlist.size === 0) {
    updateUi({
      statusText: "Ingen klipp tilgjengelig · sjekk manifestet",
      actionLabel: "Ingen klipp",
      actionDisabled: true,
      actionBusy: false,
      buttonState: "idle",
      showReset: false,
    });
  } else {
    updateUi({
      statusText: `Klar · #${playlist.cursor + 1} av ${playlist.size} gjenstår`,
      actionLabel: "Start neste",
      actionDisabled: false,
      actionBusy: false,
      buttonState: "idle",
      showReset: false,
    });
  }

  prefetchUpcomingClip();
}

const run = () => {
  bootstrap().catch((err) => {
    console.error("BingoBuzz bootstrap failed", err);
  });
};

// Expose debugging helpers for QA/testing (as referenced in ROADMAP.md)
if (typeof window !== "undefined") {
  window.bingoBuzzDebug = {
    get playlist() {
      return playlist;
    },
    get audioEngine() {
      return audioEngine;
    },
    get storage() {
      return storage;
    },
    get manifest() {
      return manifestRef;
    },
    get session() {
      return sessionRef;
    },
    // Helper to reset playlist manually (useful for testing)
    resetPlaylist() {
      resetSession();
      console.log("Playlist reset. Snapshot:", playlist.snapshot());
    },
    // Helper to check current state
    getState() {
      return {
        playlist: playlist.snapshot(),
        audioEngine: {
          state: audioEngine.state,
          currentClip: audioEngine.currentClip,
          supportsWebAudio: audioEngine.supportsWebAudio,
        },
        storage: {
          session: storage.loadSession(),
          hasFreshFlag: storage.hasFreshFlag,
          ttl: storage.ttl,
        },
        manifest: manifestRef,
      };
    },
  };
  console.info(
    "BingoBuzz debug helpers available via window.bingoBuzzDebug",
    "\nTry: bingoBuzzDebug.getState()",
    "\nOr: bingoBuzzDebug.playlist.snapshot()",
  );
}

if (document.readyState === "loading") {
  document.addEventListener("DOMContentLoaded", run, { once: true });
} else {
  run();
}


--------------------------------------------------
File End
--------------------------------------------------


assets\js\audio-engine.js
File type: .js
const DEFAULT_BASE_PATH = "assets/sounds/bingobuzz";
const DEFAULT_FORMATS = ["webm", "mp3"];
const AudioCtx = typeof window !== "undefined"
  ? window.AudioContext || window.webkitAudioContext
  : null;

const STATES = {
  idle: "idle",
  playing: "playing",
  fading: "fading",
  error: "error",
};

function now(context) {
  return context ? context.currentTime : 0;
}

async function fetchArrayBuffer(url, signal) {
  const response = await fetch(url, { signal });
  if (!response.ok) {
    throw new Error(`audio: ${url} responded with ${response.status}`);
  }
  return response.arrayBuffer();
}

function pickSourceUrls(clip, basePath, formats) {
  if (!clip) {
    return [];
  }
  const root = clip.src ?? clip.id;
  if (!root) {
    return [];
  }
  const prefix = clip.basePath ?? basePath;
  return formats.map((fmt) => `${prefix}/${root}.${fmt}`);
}

function createGainWithFade(context) {
  const gainNode = context.createGain();
  // Ensure we start unmuted.
  gainNode.gain.setValueAtTime(1, now(context));
  return gainNode;
}

function fadeGainToZero(context, gainNode, durationMs = 0) {
  const safeDuration = Number.isFinite(durationMs) ? Math.max(durationMs, 0) : 0;
  const start = now(context);
  const durationSeconds = safeDuration / 1000;
  gainNode.gain.cancelScheduledValues(start);
  gainNode.gain.setValueAtTime(gainNode.gain.value, start);
  gainNode.gain.linearRampToValueAtTime(0.0001, start + durationSeconds);
}

function fadeHtmlAudioToZero(audioEl, durationMs = 0) {
  const duration = Number.isFinite(durationMs) ? Math.max(durationMs, 0) : 0;
  if (!audioEl || duration === 0) {
    audioEl.volume = 0;
    audioEl.pause();
    return Promise.resolve();
  }
  const startVolume = audioEl.volume;
  const start = performance.now();

  return new Promise((resolve) => {
    function step(ts) {
      const elapsed = ts - start;
      const progress = Math.min(elapsed / duration, 1);
      audioEl.volume = startVolume * (1 - progress);
      if (progress >= 1) {
        audioEl.pause();
        audioEl.currentTime = 0;
        audioEl.volume = startVolume;
        resolve();
      } else {
        requestAnimationFrame(step);
      }
    }
    requestAnimationFrame(step);
  });
}

export function createAudioEngine(options = {}) {
  const supportsWebAudio = Boolean(AudioCtx);
  const state = {
    status: STATES.idle,
    context: null,
    gainNode: null,
    currentSource: null,
    currentClip: null,
    htmlAudio: null,
    abortController: null,
    basePath: options.basePath || DEFAULT_BASE_PATH,
    formats: options.formats?.length ? [...options.formats] : [...DEFAULT_FORMATS],
    lastError: null,
    listeners: {
      ended: new Set(),
    },
    prefetch: {
      clip: null,
      buffer: null,
      controller: null,
      promise: null,
    },
  };

  function emit(event, payload) {
    const set = state.listeners[event];
    if (!set) return;
    for (const listener of set) {
      try {
        listener(payload);
      } catch (error) {
        console.error(`audio: listener for ${event} failed`, error);
      }
    }
  }

  function on(event, callback) {
    if (typeof callback !== "function") {
      return () => {};
    }
    const set = state.listeners[event];
    if (!set) {
      return () => {};
    }
    set.add(callback);
    return () => {
      set.delete(callback);
    };
  }

  function setStatus(nextStatus) {
    state.status = nextStatus;
  }

  function ensureContext() {
    if (!supportsWebAudio) {
      return null;
    }
    if (!state.context) {
      state.context = new AudioCtx();
    }
    return state.context;
  }

  async function decodeAndPlayWebAudio(clip, urls) {
    const context = ensureContext();
    if (!context) {
      throw new Error("Web Audio not supported.");
    }

    const controller = new AbortController();
    state.abortController = controller;
    let lastError = null;
    for (const url of urls) {
      try {
        const arrayBuffer = await fetchArrayBuffer(url, controller.signal);
        const audioBuffer = await context.decodeAudioData(arrayBuffer.slice(0));
        await startWebAudioBuffer(audioBuffer, clip);
        return;
      } catch (error) {
        lastError = error;
        console.warn("audio: failed to use url", url, error);
      }
    }
    throw lastError ?? new Error("audio: no playable source found.");
  }

  async function playWithHtmlAudio(clip, urls) {
    const audioEl = state.htmlAudio ?? new Audio();
    state.htmlAudio = audioEl;

    let lastError = null;
    for (const url of urls) {
      try {
        audioEl.pause();
        audioEl.src = url;
        audioEl.currentTime = 0;
        audioEl.volume = 1;
        await audioEl.play();
        state.currentClip = clip;
        audioEl.onended = () => {
          if (state.status !== STATES.fading) {
            cleanupPlayback({ notify: true, reason: "ended" });
            setStatus(STATES.idle);
          }
        };
        return;
      } catch (error) {
        lastError = error;
        console.warn("audio: HTML audio failed", url, error);
      }
    }
    throw lastError ?? new Error("audio: no playable source found (HTML).");
  }

  function cleanupPlayback({ notify = false, reason = "cleanup" } = {}) {
    const clip = state.currentClip;

    if (state.currentSource) {
      try {
        state.currentSource.onended = null;
        state.currentSource.stop();
      } catch (error) {
        console.warn("audio: cleanup stop failed", error);
      }
    }
    state.currentSource = null;

    if (state.gainNode) {
      try {
        state.gainNode.disconnect();
      } catch (error) {
        console.warn("audio: cleanup disconnect failed", error);
      }
    }
    state.gainNode = null;
    state.currentClip = null;

    if (state.htmlAudio) {
      try {
        state.htmlAudio.pause();
        state.htmlAudio.currentTime = 0;
        state.htmlAudio.removeAttribute("src");
        state.htmlAudio.load();
      } catch (error) {
        console.warn("audio: cleanup html audio failed", error);
      }
    }

    if (state.abortController) {
      state.abortController.abort();
    }
    state.abortController = null;

    if (notify && clip) {
      emit("ended", { clip, reason });
    }
  }

  function clearPrefetch() {
    if (state.prefetch.controller) {
      state.prefetch.controller.abort();
    }
    state.prefetch = {
      clip: null,
      buffer: null,
      controller: null,
      promise: null,
    };
  }

  async function startWebAudioBuffer(buffer, clip) {
    const context = ensureContext();
    if (!context) {
      throw new Error("Web Audio not supported.");
    }

    const source = context.createBufferSource();
    const gainNode = createGainWithFade(context);

    source.buffer = buffer;
    source.connect(gainNode).connect(context.destination);
    source.start();

    state.currentSource = source;
    state.gainNode = gainNode;
    state.currentClip = clip;

    source.onended = () => {
      if (state.status !== STATES.fading) {
        cleanupPlayback({ notify: true, reason: "ended" });
        setStatus(STATES.idle);
      }
    };

    if (context.state === "suspended") {
      await context.resume();
    }
  }

  async function play(clip) {
    if (state.status === STATES.playing || state.status === STATES.fading) {
      throw new Error("audio: busy");
    }
    if (!clip) {
      throw new Error("audio: clip metadata missing");
    }
    const urls = pickSourceUrls(clip, state.basePath, state.formats);
    if (!urls.length) {
      throw new Error("audio: no source urls");
    }

    const prefetchedBuffer =
      supportsWebAudio &&
      state.prefetch.clip &&
      state.prefetch.clip.id === clip.id
        ? state.prefetch.buffer
        : null;

    cleanupPlayback();
    setStatus(STATES.playing);
    state.lastError = null;
    try {
      if (supportsWebAudio && prefetchedBuffer) {
        await startWebAudioBuffer(prefetchedBuffer, clip);
        clearPrefetch();
      } else if (supportsWebAudio) {
        clearPrefetch();
        await decodeAndPlayWebAudio(clip, urls);
      } else {
        clearPrefetch();
        await playWithHtmlAudio(clip, urls);
      }
      setStatus(STATES.playing);
    } catch (error) {
      cleanupPlayback({ notify: true, reason: "error" });
      state.lastError = error;
      setStatus(STATES.error);
      throw error;
    }
  }

  async function fadeOut(durationMs = 0) {
    if (state.status !== STATES.playing) {
      return;
    }
    setStatus(STATES.fading);

    try {
      const duration = Number.isFinite(durationMs) ? Math.max(durationMs, 0) : 0;
      if (supportsWebAudio && state.context && state.gainNode) {
        fadeGainToZero(state.context, state.gainNode, duration);
        const stopAt = now(state.context) + duration / 1000 + 0.02;
        state.currentSource?.stop(stopAt);
        await new Promise((resolve) => {
          const onEnd = () => {
            cleanupPlayback({ notify: true, reason: "faded" });
            setStatus(STATES.idle);
            resolve();
          };
          if (state.currentSource) {
            state.currentSource.onended = onEnd;
          } else {
            onEnd();
          }
        });
      } else if (state.htmlAudio) {
        await fadeHtmlAudioToZero(state.htmlAudio, duration);
        cleanupPlayback({ notify: true, reason: "faded" });
        setStatus(STATES.idle);
      } else {
        cleanupPlayback({ notify: true, reason: "faded" });
        setStatus(STATES.idle);
      }
    } catch (error) {
      cleanupPlayback({ notify: true, reason: "error" });
      state.lastError = error;
      setStatus(STATES.error);
      throw error;
    }
  }

  function stopImmediate() {
    cleanupPlayback({ notify: true, reason: "stopped" });
    setStatus(STATES.idle);
  }

  function configure({ basePath, formats } = {}) {
    if (typeof basePath === "string" && basePath.trim()) {
      state.basePath = basePath.trim();
    }
    if (Array.isArray(formats) && formats.length) {
      state.formats = formats
        .map((fmt) => fmt.trim())
        .filter(Boolean);
    }
  }

  function prepare(clip) {
    if (!supportsWebAudio) {
      return Promise.resolve();
    }
    if (!clip) {
      clearPrefetch();
      return Promise.resolve();
    }
    if (
      state.prefetch.clip &&
      state.prefetch.clip.id === clip.id &&
      state.prefetch.buffer
    ) {
      return state.prefetch.promise ?? Promise.resolve();
    }

    clearPrefetch();
    const urls = pickSourceUrls(clip, state.basePath, state.formats);
    if (!urls.length) {
      return Promise.resolve();
    }

    const controller = new AbortController();
    const prefetchState = {
      clip,
      buffer: null,
      controller,
      promise: null,
    };
    state.prefetch = prefetchState;

    const promise = (async () => {
      const context = ensureContext();
      if (!context) {
        return;
      }
      let lastError = null;
      for (const url of urls) {
        try {
          const arrayBuffer = await fetchArrayBuffer(url, controller.signal);
          const audioBuffer = await context.decodeAudioData(arrayBuffer.slice(0));
          if (controller.signal.aborted || state.prefetch !== prefetchState) {
            return;
          }
          prefetchState.buffer = audioBuffer;
          return;
        } catch (error) {
          if (controller.signal.aborted) {
            return;
          }
          lastError = error;
        }
      }
      throw lastError ?? new Error("audio: prefetch failed");
    })().catch((error) => {
      if (controller.signal.aborted) {
        return;
      }
      console.warn("audio: prefetch failed", error);
      if (state.prefetch === prefetchState) {
        clearPrefetch();
      }
    });

    prefetchState.promise = promise;
    return promise;
  }

  function cancelPrepare() {
    clearPrefetch();
  }

  return {
    get state() {
      return state.status;
    },
    get supportsWebAudio() {
      return supportsWebAudio;
    },
    get currentClip() {
      return state.currentClip;
    },
    get lastError() {
      return state.lastError;
    },
    on,
    configure,
    prepare,
    cancelPrepare,
    play,
    fadeOut,
    stopImmediate,
  };
}


--------------------------------------------------
File End
--------------------------------------------------


assets\js\constants.js
File type: .js
export const SESSION_TTL_MS = 3 * 60 * 60 * 1000; // 3 hours
export const STOP_FADE_MS = 1200;
export const PREFETCH_AHEAD = 1;
export const MAX_CONSECUTIVE_SKIPS = 3;

export const STORAGE_NAMESPACE = "bbz:v1";
export const QUERY_PARAM_FRESH = "fresh";
export const STORAGE_KEYS = {
  playlist: `${STORAGE_NAMESPACE}:playlist`,
  index: `${STORAGE_NAMESPACE}:index`,
  createdAt: `${STORAGE_NAMESPACE}:createdAt`,
  manifestEtag: `${STORAGE_NAMESPACE}:manifestEtag`,
};

export const MANIFEST_URL = "assets/sounds/bingobuzz/manifest.json";


--------------------------------------------------
File End
--------------------------------------------------


assets\js\manifest.js
File type: .js
import { MANIFEST_URL } from "./constants.js";

const DEFAULT_FORMATS = ["webm", "mp3"];

function toNumber(value, fallback = null) {
  if (value === null || value === undefined) {
    return fallback;
  }
  const parsed = Number(value);
  return Number.isFinite(parsed) ? parsed : fallback;
}

function sanitizeFile(entry) {
  if (!entry || typeof entry !== "object") {
    return null;
  }
  const id = typeof entry.id === "string" ? entry.id.trim() : "";
  const src = typeof entry.src === "string" ? entry.src.trim() : "";
  if (!id || !src) {
    return null;
  }
  return {
    id,
    src,
    category:
      typeof entry.category === "string" && entry.category.trim()
        ? entry.category.trim()
        : "misc",
    gain: toNumber(entry.gain, 0),
    durationHintMs: toNumber(entry.durationHintMs, null),
    etag:
      typeof entry.etag === "string" && entry.etag.trim()
        ? entry.etag.trim()
        : null,
  };
}

function normalizeManifest(raw) {
  if (!raw || typeof raw !== "object") {
    throw new Error("Manifest payload is not an object.");
  }

  const version = Number.isInteger(raw.version) ? raw.version : 1;
  const ttlHours = toNumber(raw.ttlHours, 3);
  const ttlMs =
    ttlHours && ttlHours > 0 ? Math.round(ttlHours * 60 * 60 * 1000) : null;

  const formats = Array.isArray(raw.formats) && raw.formats.length
    ? raw.formats.filter((fmt) => typeof fmt === "string" && fmt.trim())
    : DEFAULT_FORMATS;

  const normalization =
    raw.normalization && typeof raw.normalization === "object"
      ? {
          targetLufs: toNumber(raw.normalization.targetLufs, -14),
          peakDbtp: toNumber(raw.normalization.peakDbtp, -1),
        }
      : { targetLufs: -14, peakDbtp: -1 };

  const manifestEtag =
    typeof raw.manifestEtag === "string" && raw.manifestEtag.trim()
      ? raw.manifestEtag.trim()
      : null;

  const seenIds = new Set();
  const files = Array.isArray(raw.files)
    ? raw.files
        .map(sanitizeFile)
        .filter((entry) => {
          if (!entry) {
            return false;
          }
          if (seenIds.has(entry.id)) {
            console.warn("manifest: duplicate id skipped", entry.id);
            return false;
          }
          seenIds.add(entry.id);
          return true;
        })
    : [];

  if (!files.length) {
    throw new Error("Manifest does not include any playable files.");
  }

  const basePath =
    typeof raw.basePath === "string" && raw.basePath.trim()
      ? raw.basePath.trim()
      : null;

  return {
    version,
    ttlHours,
    ttlMs,
    formats,
    normalization,
    manifestEtag,
    basePath,
    files,
  };
}

export async function loadManifest(url = MANIFEST_URL) {
  try {
    const response = await fetch(url, { cache: "no-cache" });
    if (!response.ok) {
      throw new Error(`Manifest request failed (${response.status})`);
    }
    const json = await response.json();
    const manifest = normalizeManifest(json);
    return { manifest, error: null };
  } catch (error) {
    console.error("manifest: failed to load", error);
    return { manifest: null, error };
  }
}


--------------------------------------------------
File End
--------------------------------------------------


assets\js\playlist.js
File type: .js
import { MAX_CONSECUTIVE_SKIPS } from "./constants.js";

function toSeed(value) {
  if (value === null || value === undefined) {
    return null;
  }
  if (typeof value === "number" && Number.isFinite(value)) {
    return value >>> 0;
  }
  if (typeof value === "string") {
    let hash = 0;
    for (let i = 0; i < value.length; i += 1) {
      hash = (hash << 5) - hash + value.charCodeAt(i);
      hash |= 0; // Convert to 32-bit int
    }
    return hash >>> 0;
  }
  return null;
}

function createSeededRandom(seedValue) {
  const seed = toSeed(seedValue);
  if (seed === null) {
    return null;
  }
  let state = seed || 1;
  return function rng() {
    state += 0x6d2b79f5;
    let t = state;
    t = Math.imul(t ^ (t >>> 15), t | 1);
    t ^= t + Math.imul(t ^ (t >>> 7), t | 61);
    return ((t ^ (t >>> 14)) >>> 0) / 4294967296;
  };
}

function fisherYatesShuffle(arr, seed) {
  const result = [...arr];
  const rng = createSeededRandom(seed) ?? Math.random;
  for (let i = result.length - 1; i > 0; i -= 1) {
    const j = Math.floor(rng() * (i + 1));
    [result[i], result[j]] = [result[j], result[i]];
  }
  return result;
}

function clamp(value, min, max) {
  return Math.min(Math.max(value, min), max);
}

export function createPlaylist() {
  const state = {
    trackMap: new Map(),
    order: [],
    cursor: 0,
    seed: null,
    lastId: null,
    consecutiveSkips: 0,
  };

  function hydrateTrackMap(files) {
    state.trackMap.clear();
    if (!Array.isArray(files)) {
      return;
    }
    for (const file of files) {
      if (file?.id) {
        state.trackMap.set(file.id, file);
      }
    }
  }

  function buildOrder({ order, seed } = {}) {
    const allIds = [...state.trackMap.keys()];
    if (!allIds.length) {
      state.order = [];
      return;
    }

    if (Array.isArray(order) && order.length) {
      const seen = new Set();
      const filtered = [];
      for (const id of order) {
        if (state.trackMap.has(id) && !seen.has(id)) {
          filtered.push(id);
          seen.add(id);
        }
      }
      for (const id of allIds) {
        if (!seen.has(id)) {
          filtered.push(id);
          seen.add(id);
        }
      }
      state.order = filtered;
      return;
    }

    state.order = fisherYatesShuffle(allIds, seed);
  }

  function getSnapshot() {
    return {
      order: [...state.order],
      index: state.cursor,
      total: state.order.length,
      remaining: Math.max(state.order.length - state.cursor, 0),
      seed: state.seed,
    };
  }

  function ensureInitialized() {
    return state.order.length > 0;
  }

  function next() {
    if (!ensureInitialized() || state.cursor >= state.order.length) {
      return { clip: null, done: true };
    }
    let clip = null;
    let safety = state.order.length;
    while (state.cursor < state.order.length && safety > 0) {
      const id = state.order[state.cursor];
      clip = state.trackMap.get(id) ?? null;
      state.cursor += 1;
      state.lastId = id;
      if (clip) {
        break;
      }
      safety -= 1;
    }

    if (!clip) {
      return { clip: null, done: true };
    }

    return {
      clip,
      done: state.cursor >= state.order.length,
      index: state.cursor - 1,
      total: state.order.length,
      remaining: Math.max(state.order.length - state.cursor, 0),
    };
  }

  function peek() {
    if (!ensureInitialized() || state.cursor >= state.order.length) {
      return null;
    }
    const id = state.order[state.cursor];
    return state.trackMap.get(id) ?? null;
  }

  function reset({ seed } = {}) {
    state.seed = seed ?? Date.now();
    buildOrder({ seed: state.seed });
    state.cursor = 0;
    state.lastId = null;
    state.consecutiveSkips = 0;
    return getSnapshot();
  }

  function init(files, options = {}) {
    hydrateTrackMap(files);
    state.seed = options.seed ?? state.seed ?? Date.now();
    buildOrder({ order: options.order, seed: state.seed });
    state.cursor = clamp(options.index ?? 0, 0, state.order.length);
    state.lastId = null;
    state.consecutiveSkips = 0;
    return getSnapshot();
  }

  function skipFailed(badId) {
    const targetId = badId ?? state.lastId;
    if (targetId) {
      const idx = state.order.indexOf(targetId);
      if (idx !== -1) {
        state.order.splice(idx, 1);
        if (state.cursor > idx) {
          state.cursor -= 1;
        }
      }
    }

    state.consecutiveSkips += 1;
    if (state.consecutiveSkips > MAX_CONSECUTIVE_SKIPS) {
      return {
        clip: null,
        done: true,
        exhausted: true,
        skipped: state.consecutiveSkips,
      };
    }

    if (!ensureInitialized() || state.cursor >= state.order.length) {
      return {
        clip: null,
        done: true,
        exhausted: true,
        skipped: state.consecutiveSkips,
      };
    }

    const result = next();
    return {
      ...result,
      skipped: state.consecutiveSkips,
      exhausted: !result.clip,
    };
  }

  function markSuccess() {
    state.consecutiveSkips = 0;
  }

  function isComplete() {
    return state.cursor >= state.order.length;
  }

  return {
    init,
    next,
    peek,
    reset,
    skipFailed,
    markSuccess,
    isComplete,
    snapshot: getSnapshot,
    get size() {
      return state.order.length;
    },
    get cursor() {
      return state.cursor;
    },
  };
}


--------------------------------------------------
File End
--------------------------------------------------


assets\js\storage.js
File type: .js
import {
  STORAGE_KEYS,
  QUERY_PARAM_FRESH,
  STORAGE_NAMESPACE,
} from "./constants.js";

const TRUTHY_FRESH_VALUES = new Set(["1", "true", "yes", "fresh"]);

function getLocalStorage() {
  try {
    if (typeof window === "undefined") {
      return null;
    }
    return window.localStorage ?? null;
  } catch (error) {
    console.warn("storage: localStorage unavailable", error);
    return null;
  }
}

function parseJson(value) {
  try {
    return JSON.parse(value);
  } catch (error) {
    console.warn("storage: failed to parse JSON", { value, error });
    return null;
  }
}

function parseIntSafe(value) {
  const parsed = Number.parseInt(value, 10);
  return Number.isNaN(parsed) ? null : parsed;
}

function detectFreshFlag() {
  if (typeof window === "undefined") {
    return false;
  }
  const params = new URLSearchParams(window.location.search);
  const raw = params.get(QUERY_PARAM_FRESH);
  if (raw === null) {
    return false;
  }
  return TRUTHY_FRESH_VALUES.has(raw.toLowerCase());
}

export function createStorage({ ttl }) {
  let ttlMs = typeof ttl === "number" && ttl > 0 ? ttl : null;
  const hasFreshFlag = detectFreshFlag();

  function loadSession() {
    const store = getLocalStorage();
    if (!store) {
      return null;
    }

    const playlistRaw = store.getItem(STORAGE_KEYS.playlist);
    const indexRaw = store.getItem(STORAGE_KEYS.index);
    const createdAtRaw = store.getItem(STORAGE_KEYS.createdAt);
    const manifestEtag = store.getItem(STORAGE_KEYS.manifestEtag);

    if (!playlistRaw || indexRaw === null || createdAtRaw === null) {
      return null;
    }

    const playlistIds = parseJson(playlistRaw);
    const index = parseIntSafe(indexRaw);
    const createdAt = parseIntSafe(createdAtRaw);

    if (!Array.isArray(playlistIds) || index === null || createdAt === null) {
      clearSession();
      return null;
    }

    return {
      playlistIds,
      index,
      createdAt,
      manifestEtag: manifestEtag || null,
    };
  }

  function saveSession({ playlistIds, index, createdAt, manifestEtag }) {
    const store = getLocalStorage();
    if (!store) {
      return;
    }
    if (!Array.isArray(playlistIds) || typeof index !== "number") {
      console.warn("storage: invalid session payload", {
        playlistIds,
        index,
        createdAt,
        manifestEtag,
      });
      return;
    }
    try {
      store.setItem(STORAGE_KEYS.playlist, JSON.stringify(playlistIds));
      store.setItem(STORAGE_KEYS.index, String(index));
      store.setItem(STORAGE_KEYS.createdAt, String(createdAt ?? Date.now()));
      if (manifestEtag) {
        store.setItem(STORAGE_KEYS.manifestEtag, manifestEtag);
      } else {
        store.removeItem(STORAGE_KEYS.manifestEtag);
      }
    } catch (error) {
      console.warn("storage: saveSession failed", error);
    }
  }

  function clearSession() {
    const store = getLocalStorage();
    if (!store) {
      return;
    }
    try {
      store.removeItem(STORAGE_KEYS.playlist);
      store.removeItem(STORAGE_KEYS.index);
      store.removeItem(STORAGE_KEYS.createdAt);
      store.removeItem(STORAGE_KEYS.manifestEtag);
    } catch (error) {
      console.warn("storage: clearSession failed", error);
    }
  }

  function shouldReset({ session, manifestEtag, now = Date.now() } = {}) {
    if (hasFreshFlag) {
      return { reset: true, reason: "fresh-flag" };
    }

    if (!session) {
      return { reset: true, reason: "missing-session" };
    }

    if (manifestEtag) {
      if (!session.manifestEtag) {
        return { reset: true, reason: "manifest-unknown" };
      }
      if (session.manifestEtag !== manifestEtag) {
        return { reset: true, reason: "manifest-mismatch" };
      }
    }

    if (ttlMs && session.createdAt) {
      const age = now - session.createdAt;
      if (age >= ttlMs) {
        return { reset: true, reason: "session-expired" };
      }
    }

    return { reset: false, reason: "session-valid" };
  }

  function setTtl(newTtl) {
    if (typeof newTtl === "number" && newTtl > 0) {
      ttlMs = newTtl;
    }
  }

  return {
    namespace: STORAGE_NAMESPACE,
    hasFreshFlag,
    loadSession,
    saveSession,
    clearSession,
    shouldReset,
    setTtl,
    get ttl() {
      return ttlMs;
    },
  };
}


--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\BingoBlast.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   QTIT2     ÿþB i n g o   B l a s t WOAS   :  https://suno.com/song/0b9f2e67-5607-413c-abb8-7cc2638bfde9TPE1     ÿþf a s t s t y l e 9 4 1 APIC  |»   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\BingoBlast2.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   >nTIT2     ÿþB i n g o   B l a s t WOAS   :  https://suno.com/song/34d7e035-1f33-450a-8d54-46852513a002TPE1     ÿþf a s t s t y l e 9 4 1 APIC  NØ   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\manifest.json
File type: .json
{
  "version": 1,
  "ttlHours": 3,
  "formats": ["mp3"],
  "basePath": "assets/sounds/bingobuzz/NonCommerseLicense",
  "normalization": {
    "targetLufs": -14,
    "peakDbtp": -1
  },
  "manifestEtag": "nc-pack-v1",
  "files": [
    {
      "id": "anei-jeg-mener-a-ja-bingo",
      "src": "ANeiJegMenerAJaBingo",
      "category": "voice",
      "gain": 0,
      "etag": "ANeiJegMenerAJaBingo-v1"
    },
    {
      "id": "bingo-en-opera-jingle-a",
      "src": "BINGOEnOperajingle",
      "category": "jingle",
      "gain": 0,
      "etag": "BINGOEnOperajingle-v1"
    },
    {
      "id": "bingo-en-opera-jingle-b",
      "src": "BINGOEnOperajingle1",
      "category": "jingle",
      "gain": 0,
      "etag": "BINGOEnOperajingle1-v1"
    },
    {
      "id": "bingo-baby-a",
      "src": "BingoBaby",
      "category": "music",
      "gain": 0,
      "etag": "BingoBaby-v1"
    },
    {
      "id": "bingo-baby-b",
      "src": "BingoBaby1",
      "category": "music",
      "gain": 0,
      "etag": "BingoBaby1-v1"
    },
    {
      "id": "bingo-bash-a",
      "src": "BingoBash",
      "category": "music",
      "gain": 0,
      "etag": "BingoBash-v1"
    },
    {
      "id": "bingo-bash-b",
      "src": "BingoBash1",
      "category": "music",
      "gain": 0,
      "etag": "BingoBash1-v1"
    },
    {
      "id": "bingo-beat-a",
      "src": "BingoBeat",
      "category": "music",
      "gain": 0,
      "etag": "BingoBeat-v1"
    },
    {
      "id": "bingo-beat-b",
      "src": "BingoBeat1",
      "category": "music",
      "gain": 0,
      "etag": "BingoBeat1-v1"
    },
    {
      "id": "bingo-fever-a",
      "src": "BingoFever",
      "category": "music",
      "gain": 0,
      "etag": "BingoFever-v1"
    },
    {
      "id": "bingo-fever-b",
      "src": "BingoFever1",
      "category": "music",
      "gain": 0,
      "etag": "BingoFever1-v1"
    },
    {
      "id": "bingo-jingle-a",
      "src": "BingoJingle",
      "category": "jingle",
      "gain": 0,
      "etag": "BingoJingle-v1"
    },
    {
      "id": "bingo-jingle-b",
      "src": "BingoJingle1",
      "category": "jingle",
      "gain": 0,
      "etag": "BingoJingle1-v1"
    },
    {
      "id": "bingo-jingle-c",
      "src": "BingoJingle2",
      "category": "jingle",
      "gain": 0,
      "etag": "BingoJingle2-v1"
    },
    {
      "id": "bingo-jingle-d",
      "src": "BingoJingle3",
      "category": "jingle",
      "gain": 0,
      "etag": "BingoJingle3-v1"
    },
    {
      "id": "bingo-showstopper-a",
      "src": "BingoShowstopper",
      "category": "jingle",
      "gain": 0,
      "etag": "BingoShowstopper-v1"
    },
    {
      "id": "bingo-showstopper-b",
      "src": "BingoShowstopper1",
      "category": "jingle",
      "gain": 0,
      "etag": "BingoShowstopper1-v1"
    },
    {
      "id": "ja-takk",
      "src": "JATAKK",
      "category": "voice",
      "gain": 0,
      "etag": "JATAKK-v1"
    },
    {
      "id": "jeg-fikk-bingo-a",
      "src": "JegFikkBingo",
      "category": "voice",
      "gain": 0,
      "etag": "JegFikkBingo-v1"
    },
    {
      "id": "jeg-fikk-bingo-b",
      "src": "JegFikkBingo1",
      "category": "voice",
      "gain": 0,
      "etag": "JegFikkBingo1-v1"
    },
    {
      "id": "jeg-skal-ha-gull-a",
      "src": "JegSkalHaGull",
      "category": "voice",
      "gain": 0,
      "etag": "JegSkalHaGull-v1"
    },
    {
      "id": "jeg-skal-ha-gull-b",
      "src": "JegSkalHaGull1",
      "category": "voice",
      "gain": 0,
      "etag": "JegSkalHaGull1-v1"
    },
    {
      "id": "kake-til-meg-a",
      "src": "KakeTilMeg",
      "category": "voice",
      "gain": 0,
      "etag": "KakeTilMeg-v1"
    },
    {
      "id": "kake-til-meg-b",
      "src": "KakeTilMeg1",
      "category": "voice",
      "gain": 0,
      "etag": "KakeTilMeg1-v1"
    },
    {
      "id": "premie-jeg-fikk-premie-a",
      "src": "PREMIEJEGFIKKPREMIE",
      "category": "voice",
      "gain": 0,
      "etag": "PREMIEJEGFIKKPREMIE-v1"
    },
    {
      "id": "premie-jeg-fikk-premie-b",
      "src": "PREMIEJEGFIKKPREMIE1",
      "category": "voice",
      "gain": 0,
      "etag": "PREMIEJEGFIKKPREMIE1-v1"
    },
    {
      "id": "premie-jubel-a",
      "src": "Premiejubel",
      "category": "cheer",
      "gain": 0,
      "etag": "Premiejubel-v1"
    },
    {
      "id": "premie-jubel-b",
      "src": "Premiejubel1",
      "category": "cheer",
      "gain": 0,
      "etag": "Premiejubel1-v1"
    },
    {
      "id": "woohoo-revolt",
      "src": "WoohooRevolt",
      "category": "cheer",
      "gain": 0,
      "etag": "WoohooRevolt-v1"
    }
  ]
}


--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\ANeiJegMenerAJaBingo.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3    lxTIT2   ?  ÿþÅ   N e i      J e g   M e n e r   Å   J a ,   B i n g o ! WOAS   :  https://suno.com/song/9ff93bd0-9030-45da-addf-e81e17c494d6TPE1     ÿþf a s t s t y l e 9 4 1 APIC  %¼   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*45...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoBaby.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   	6TIT2     ÿþB i n g o ,   B a b y ! WOAS   :  https://suno.com/song/a838bf3d-dfba-44e5-950b-cedeedb0311dTPE1     ÿþf a s t s t y l e 9 4 1 APIC  4   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxy...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoBaby1.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   
$TIT2     ÿþB i n g o ,   B a b y ! WOAS   :  https://suno.com/song/82bd8e30-343b-44e2-a4bb-9564020860cfTPE1     ÿþf a s t s t y l e 9 4 1 APIC  6   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxy...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoBash.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   8YTIT2     ÿþB i n g o   B a s h ! WOAS   :  https://suno.com/song/7de25d81-ced0-429f-891e-5a1f02e2632dTPE1     ÿþf a s t s t y l e 9 4 1 APIC  KÃ   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoBash1.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   *WTIT2     ÿþB i n g o   B a s h ! WOAS   :  https://suno.com/song/496c346e-078d-4c56-8ab2-2e035e1f0230TPE1     ÿþf a s t s t y l e 9 4 1 APIC  DÁ   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoBeat.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   &TIT2     ÿþB i n g o   B e a t WOAS   :  https://suno.com/song/8a9e1e25-b130-4e27-9772-73984f2373e0TPE1     ÿþf a s t s t y l e 9 4 1 APIC  B|   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoBeat1.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   [TIT2     ÿþB i n g o   B e a t WOAS   :  https://suno.com/song/984b17bb-990b-4dc3-bdcf-1f461e0a30dfTPE1     ÿþf a s t s t y l e 9 4 1 APIC  8G   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BINGOEnOperajingle.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   'TIT2   -  ÿþB I N G O !   E n   O p e r a j i n g l e WOAS   :  https://suno.com/song/9d004ff3-af83-40b6-9847-367d8f607a0cTPE1     ÿþf a s t s t y l e 9 4 1 APIC  6}   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVW...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BINGOEnOperajingle1.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   RTIT2   -  ÿþB I N G O !   E n   O p e r a j i n g l e WOAS   :  https://suno.com/song/c3b72a2e-9197-411a-a60b-a1a3c08ccda3TPE1     ÿþf a s t s t y l e 9 4 1 APIC  ?(   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVW...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoFever.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   CTIT2     ÿþB i n g o   F e v e r WOAS   :  https://suno.com/song/491b8a47-9388-4ece-9432-ca7e739f53dbTPE1     ÿþf a s t s t y l e 9 4 1 APIC  Q   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoFever1.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   P\TIT2     ÿþB i n g o   F e v e r WOAS   :  https://suno.com/song/6330b4bf-1f77-4a2c-ba2d-ec22dab9e3bdTPE1     ÿþf a s t s t y l e 9 4 1 APIC  WÆ   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoJingle.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   (6TIT2     ÿþB i n g o   J i n g l e WOAS   :  https://suno.com/song/cb7b9a80-deeb-420a-9b22-0a8ae9020847TPE1     ÿþf a s t s t y l e 9 4 1 APIC  C   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxy...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoJingle1.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   DtTIT2     ÿþB i n g o   J i n g l e WOAS   :  https://suno.com/song/64139da3-dc36-4f99-9d89-132d0fca2cc2TPE1     ÿþf a s t s t y l e 9 4 1 APIC  QÜ   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxy...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoJingle2.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   ${TIT2     ÿþB i n g o   J i n g l e WOAS   :  https://suno.com/song/3c3c74ab-6007-4dbb-b3e4-11acd1816e20TPE1     ÿþf a s t s t y l e 9 4 1 APIC  Aã   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxy...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoJingle3.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   0TIT2     ÿþB i n g o   J i n g l e WOAS   :  https://suno.com/song/afa20b2c-07f3-47cb-a75f-6752eeba8d2bTPE1     ÿþf a s t s t y l e 9 4 1 APIC  Gp   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxy...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoShowstopper.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   TITIT2   %  ÿþB i n g o   S h o w s t o p p e r WOAS   :  https://suno.com/song/46c20001-bd59-4f0c-a3d3-761917f10481TPE1     ÿþf a s t s t y l e 9 4 1 APIC  Y§   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefg...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\BingoShowstopper1.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   e4TIT2   %  ÿþB i n g o   S h o w s t o p p e r WOAS   :  https://suno.com/song/df01556b-4aa2-4956-b841-26b9a4ed231dTPE1     ÿþf a s t s t y l e 9 4 1 APIC  b   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefg...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\JATAKK.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   ?ITIT2     ÿþJ A   T A K K ! WOAS   :  https://suno.com/song/9add2e3f-a2c4-4957-afc9-4dbc0c9fa392TPE1     ÿþf a s t s t y l e 9 4 1 APIC  O9   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\JegFikkBingo.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   
YTIT2   !  ÿþJ e g   F i k k   B i n g o ! WOAS   :  https://suno.com/song/c99fbfb0-5553-4505-94e8-2beac838c98bTPE1     ÿþf a s t s t y l e 9 4 1 APIC  6;   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijs...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\JegFikkBingo1.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3    HTIT2   !  ÿþJ e g   F i k k   B i n g o ! WOAS   :  https://suno.com/song/9d367fed-5780-451a-b765-4d4cc3a1e1f4TPE1     ÿþf a s t s t y l e 9 4 1 APIC  ?ª   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijs...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\JegSkalHaGull.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   H.TIT2   %  ÿþJ e g   S k a l   H a   G u l l ! WOAS   :  https://suno.com/song/6290d089-cac8-4fef-893e-4994c13c0979TPE1     ÿþf a s t s t y l e 9 4 1 APIC  S   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefg...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\JegSkalHaGull1.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   9TIT2   %  ÿþJ e g   S k a l   H a   G u l l ! WOAS   :  https://suno.com/song/2045ce34-cadd-4e23-96d7-199954f98bd7TPE1     ÿþf a s t s t y l e 9 4 1 APIC  Kß   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefg...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\KakeTilMeg.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   "TIT2     ÿþK a k e   T i l   M e g ! WOAS   :  https://suno.com/song/010e7849-ae58-4dd6-8ae9-c0221cf3d691TPE1     ÿþf a s t s t y l e 9 4 1 APIC  2   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvw...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\KakeTilMeg1.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3    CTIT2     ÿþK a k e   T i l   M e g ! WOAS   :  https://suno.com/song/b5a6b6ee-647e-4abb-9a4d-9dc320735488TPE1     ÿþf a s t s t y l e 9 4 1 APIC  /©   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvw...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\PREMIEJEGFIKKPREMIE.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   ,TIT2   3  ÿþP R E M I E !   J E G   F I K K   P R E M I E ! WOAS   :  https://suno.com/song/88d0fb22-c118-4254-81e3-e10291872a5cTPE1     ÿþf a s t s t y l e 9 4 1 APIC  <ü   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHI...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\PREMIEJEGFIKKPREMIE1.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   '=TIT2   3  ÿþP R E M I E !   J E G   F I K K   P R E M I E ! WOAS   :  https://suno.com/song/1692d503-7aee-459b-a737-1ab76bed4b4eTPE1     ÿþf a s t s t y l e 9 4 1 APIC  C
   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHI...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\Premiejubel.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   (TIT2     ÿþP r e m i e j u b e l WOAS   :  https://suno.com/song/06ccfb67-f481-47f1-b323-b5aa8ee65418TPE1     ÿþf a s t s t y l e 9 4 1 APIC  >   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\Premiejubel1.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   zJTIT2     ÿþP r e m i e j u b e l WOAS   :  https://suno.com/song/5f471e41-7a1c-4754-9f1d-d8142dd12810TPE1     ÿþf a s t s t y l e 9 4 1 APIC  l´   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvwxyz...

--------------------------------------------------
File End
--------------------------------------------------


assets\sounds\bingobuzz\NonCommerseLicense\WoohooRevolt.mp3
File type: .mp3
[Binary/Non-UTF8 file - showing first 500 chars]
ID3   gTIT2     ÿþW o o h o o   R e v o l t WOAS   :  https://suno.com/song/e58b8fe4-ad64-4ffa-9aa3-ff1a34a58c2dTPE1     ÿþf a s t s t y l e 9 4 1 APIC  9Í   image/jpeg Cover ÿØÿà JFIF      ÿÛ C 

(1#%(:3=<9387@H\N@DWE78PmQW_bghg>Mqypdx\egcÿÛ C//cB8BccccccccccccccccccccccccccccccccccccccccccccccccccÿÀ hh" ÿÄ           	
ÿÄ µ   } !1AQa"q2¡#B±ÁRÑð$3br	
%&'()*456789:CDEFGHIJSTUVWXYZcdefghijstuvw...

--------------------------------------------------
File End
--------------------------------------------------


docs\ROADMAP.md
File type: .md
# BingoBuzz Implementation Roadmap

## 1. Project Scaffolding
- Init basic structure: `index.html`, `assets/css/style.css`, `assets/js/{app.js,audio-engine.js,playlist.js,storage.js,constants.js}`, `assets/sounds/bingobuzz/manifest.json`.
- Draft semantic markup with primary/secondary buttons and status region (`aria-live="polite"`).
- Establish shared constants (`SESSION_TTL_MS`, `STOP_FADE_MS`, `PREFETCH_AHEAD`, `MAX_CONSECUTIVE_SKIPS`).

## 2. Manifest & Storage Layer
- Define manifest schema with `formats`, `normalization`, per-file `durationHintMs`, `etag`, and top-level `manifestEtag`.
- Implement loader that fetches/validates manifest, falls back gracefully on fetch errors.
- Build `storage.js` with helpers:
  - `loadSession()`, `saveSession(sessionState)`, `clearSession()`.
  - `shouldReset({ manifestEtag, now })` factoring TTL (`SESSION_TTL_MS`), `?fresh=1`, and manifest mismatch.
  - Namespace localStorage keys `bbz:v1:{playlist,index,createdAt,manifestEtag}`.

## 3. Playlist Engine
- Implement `playlist.js` exposing:
  - `init(files, seed?)` (Fisher–Yates shuffle with optional seed).
  - `next()` returning `{ clip, done }`.
  - `peek()` without advancing cursor.
  - `reset()` to reshuffle and zero cursor.
  - `skipFailed(badId)` to advance past defective tracks (guard with `MAX_CONSECUTIVE_SKIPS`).
  - `isComplete()` for UI lockout.
- Ensure session state can serialize/restore `playlist` order and cursor index.

## 4. Audio Engine
- Use Web Audio API as primary path; lazy-initialize `AudioContext` on first trusted interaction.
- Implement `play(clipMeta)` returning a promise that resolves on start or rejects if `state !== idle`.
- Implement `fadeOut(duration = STOP_FADE_MS)` with gain ramp; no-op if already idle.
- Provide fallback `<audio>` element path when Web Audio unsupported; share contract semantics.
- Track readable `state` (`idle`, `playing`, `fading`, `error`) and emit hooks/events for UI updates.
- Prefetch next `PREFETCH_AHEAD` sources when feasible; respect `durationHintMs` to avoid heavy decode.

## 5. App Orchestration
- In `app.js`, bootstrap flow:
  - Fetch manifest, check `storage.shouldReset`, hydrate playlist/audio, restore UI state.
- Bind hovedknappen til en togglet flow: idle trykk → `playlist.next` + `audio.play`, playing trykk → `audio.fadeOut`.
  - Reflect state transitions in DOM (button `disabled`/`aria-disabled`, busy animations, status text).
  - Handle automatic reset when playlist complete (show “Start på nytt”), and manual reset action.
  - Integrate error handling: on playback failure call `playlist.skipFailed`, retry until `MAX_CONSECUTIVE_SKIPS`.
- Monitor TTL while page is open; on next interaction post-expiry, trigger full reset.

## 6. UI & Styling
- Craft `style.css` with CSS custom properties, layout, responsive sizing, and accessible focus rings.
- Implement busy/disabled/fade states using classes; add subtle animations with `prefers-reduced-motion` guards.
- Include iconography (optional) and ensure contrast ratios meet accessibility guidelines.

## 7. Testing & QA
- Manual acceptance checklist:
  - Shuffle invariant: full cycle plays each clip once.
  - TTL reset: manipulate `createdAt` to exceed 3h → next interaction reshuffles.
  - Busy guard: rapid clicks on “Start neste” during playback/fade cause no overlaps.
  - Format fallback: simulate failed WebM to confirm MP3 path.
  - Accessibility: keyboard activation, focus management, `aria-live` updates.
- (Future) Add lightweight unit tests for `playlist` logic and storage TTL math via simple test harness.

### Browser QA Playbook
- **Forberedelser**
  - Åpne developer tools (`F12`), behold `Console` og `Application > Storage > Local Storage`.
  - Tøm `localStorage` (`localStorage.clear()`) før første test for ren tilstand.
  - Bekreft at manifestet laster (ingen røde feil i konsollen).
  - Debug-verktøy er tilgjengelig via `window.bingoBuzzDebug`: `bingoBuzzDebug.getState()`, `bingoBuzzDebug.playlist.snapshot()`, etc.

- **Standard flyt**
  - Første trykk på hovedknappen (`Start neste`) skal starte lyd og oppdatere label til `Fade ut`.
  - Vent til avspillingen stopper av seg selv; knappen skal gå tilbake til `Start neste` og status vise `Klar · #2 av N gjenstår`.
  - Gjenta for minst tre klipp, og sjekk at `localStorage`-feltene (`bbz:v1:*`) oppdateres etter hvert spor.

- **Fade-test**
  - Start et klipp og trykk knappen igjen (den viser `Fade ut`). Lyd skal fade innen ~1.2 s og status gå `Fader ut …` → `Klar …`.
  - Etter fade skal knappen automatisk vise `Start neste` og være klar for neste trykk.

- **Busy-guard**
  - Klikk knappen gjentatte ganger mens et klipp spiller; første ekstra trykk skal trigge fade, senere klikk under fade skal ignoreres (kort `is-busy`-puls, ingen feil).
  - Etter fade, bekreft at neste trykk starter neste klipp umiddelbart.

- **Full syklus + auto-reset**
  - Spill gjennom alle klipp (evt. i testmodus: kjør `bingoBuzzDebug.resetPlaylist()` i konsollen og bruk `bingoBuzzDebug.playlist.snapshot()` for fremdrift).
  - Når siste klipp er ferdig, status skal vise `Alt spilt i denne økta · Start på nytt`, og knappen skal vise `Alt spilt` (deaktivert).
  - Klikk "Start på nytt"; bekreft at knappen viser `Start neste`, ny rekkefølge genereres og `localStorage` får nytt `createdAt`.
  - Verifiser med `bingoBuzzDebug.getState()` for full oversikt over tilstand.

- **TTL / fresh flag**
  - I devtools, sett `bbz:v1:createdAt` til en verdi >3 timer tilbake (`Date.now() - 3.5*60*60*1000`).
  - Reload siden, trykk “Start neste”; forvent at køen reshuffles (sjekk `playlistIds` endres) og status er “Klar …”.
  - Test `?fresh=1` ved å laste `index.html?fresh=1`; bekreft automatisk reset.

- **Feilhåndtering / skip**
  - Midlertidig gi én fil feil navn (f.eks. endre i filsystemet til `*.bak`) og reload.
  - Trykk “Start neste”; når filen nås, status skal vise “Hoppet over en fil · prøver neste …” og neste klipp skal starte.
  - Revert filnavnet etter verifikasjon.

- **Tilgjengelighet**
  - Naviger med `Tab` til hovedknappen; fokusring skal være tydelig.
  - Bruk `Space`/`Enter`; første aktivering starter lyd, andre aktiverer fade.
  - I Console: `document.querySelector('#status-line').getAttribute('role')` → skal være `status`; observer `aria-live` ved avspillingsendringer.

- **Persistens på tvers av reload**
  - Spill ett klipp, reload siden (uten å cleare storage); status skal vise neste indeks (`#2 av N gjenstår`).
  - Bekreft at knappen viser `Start neste` etter reload og starter neste klipp uten repetisjon.

- **Mobilrespons (valgfritt)**
  - Aktiver device toolbar i devtools (f.eks. iPhone 12). Knappene skal fortsatt være fullt brede, fokus og status lesbare.
  - Test tapping for play/fade; se etter utilsiktet zoom eller layout-skift.

## 8. Future Enhancements (Backlog)
- Volume slider and fade-length options persisted via storage.
- Offline caching with Service Worker and versioned assets.
- Multi-tab coordination via `BroadcastChannel`.
- Telemetry/logging hooks for monitoring playback errors.


--------------------------------------------------
File End
--------------------------------------------------
